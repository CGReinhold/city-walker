import { useEffect, useState } from 'react';
import { CITIES } from './cities';
import noise from './noise2.gif';

const getRandom = (list) => {
  return list[Math.floor(Math.random() * list.length)];
};

function App() {
  const [city, setCity] = useState(null);
  const [style, setStyle] = useState('sunny');
  const [showNoise, setShowNoise] = useState(true);
  const [expanded, setExpanded] = useState(true);
  const [enableSound, setEnableSound] = useState(false);

  useEffect(() => {
    setShowNoise(true);
    const interval = setInterval(() => {
      setShowNoise(false);
    }, 3000);

    return () => clearInterval(interval);
  }, [city, style, enableSound]);

  useEffect(() => {
    const randomCity = getRandom(CITIES);
    setCity(randomCity);
  }, []);

  if (!city) {
    return <div></div>;
  }

  const videoURL = `https://www.youtube.com/watch?v=${city.videos[style]}`;
  const iframeURL = `https://www.youtube.com/embed/${city.videos[style]}?autoplay=1&amp;mute=${enableSound ? '0' : '1'}&amp;origin=http://cgreinhold.dev&amp;controls=0&amp;start=40&amp;playsinline=1&amp;rel=0&amp;showinfo=0&amp;enablejsapi=1&amp;widgetid=1`;

  return (
    <div className="app">
      <div className="video">
        <iframe
          allowfullscreen="1"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          title="City walker"
          src={iframeURL}
          id="player"
          width="100%"
          height="100%"
          frameborder="0"
        />
      </div>
      {showNoise && (
        <img className="noise" src={noise} alt="noise" />
      )}
      <div className={"top" + (expanded ? "" : " collapsed")}>
        {expanded && (
          <div className="configs">
            <h2>Walk Around the World!</h2>
            <div className="city-list">
              {CITIES.map(c => (
                <div
                  key={c.name}
                  className={"city-item" + (c.name === city.name ? " selected" : "")}
                  onClick={() => {
                    setCity(c);
                    if (!c.videos[style]) {
                      setStyle('sunny');
                    }
                  }}
                >
                  {c.name}
                </div>
              ))}
            </div>
            <div className="styles">
              {city.videos.sunny && (
                <div className={style === 'sunny' ? 'selected' : ''} onClick={() => setStyle('sunny')}>
                  <svg fill="white" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><g><path d="m121 256c0 74.439 60.561 135 135 135s135-60.561 135-135-60.561-135-135-135-135 60.561-135 135zm135-105c57.897 0 105 47.103 105 105s-47.103 105-105 105-105-47.103-105-105 47.103-105 105-105z"/><path d="m372.673 372.673c-5.858 5.858-5.858 15.355 0 21.213l72.426 72.426c5.857 5.858 15.355 5.859 21.213 0 5.858-5.858 5.858-15.355 0-21.213l-72.426-72.426c-5.858-5.859-15.356-5.859-21.213 0z"/><path d="m66.901 45.688c-5.857-5.858-15.355-5.858-21.213 0s-5.858 15.355 0 21.213l72.426 72.426c5.857 5.858 15.355 5.859 21.213 0 5.858-5.858 5.858-15.355 0-21.213z"/><path d="m45.688 466.312c5.857 5.858 15.355 5.859 21.213 0l72.426-72.426c5.858-5.858 5.858-15.355 0-21.213-5.857-5.858-15.355-5.858-21.213 0l-72.426 72.426c-5.858 5.858-5.858 15.355 0 21.213z"/><path d="m466.312 45.688c-5.857-5.858-15.355-5.858-21.213 0l-72.426 72.426c-5.858 5.858-5.858 15.355 0 21.213 5.857 5.858 15.355 5.859 21.213 0l72.426-72.426c5.858-5.858 5.858-15.355 0-21.213z"/><path d="m319.143 408.44c-7.654 3.17-11.288 11.945-8.118 19.599l11.48 27.716c3.166 7.642 11.934 11.293 19.599 8.118 7.654-3.17 11.288-11.945 8.118-19.599l-11.48-27.716c-3.171-7.654-11.945-11.287-19.599-8.118z"/><path d="m192.857 103.56c7.654-3.17 11.288-11.945 8.118-19.599l-11.48-27.716c-3.171-7.654-11.945-11.287-19.599-8.118-7.654 3.17-11.288 11.945-8.118 19.599l11.48 27.716c3.167 7.642 11.934 11.293 19.599 8.118z"/><path d="m83.961 311.024-27.716 11.48c-7.654 3.17-11.288 11.945-8.118 19.599 3.166 7.642 11.934 11.293 19.599 8.118l27.716-11.48c7.654-3.17 11.288-11.945 8.118-19.599-3.17-7.653-11.944-11.286-19.599-8.118z"/><path d="m428.039 200.976 27.716-11.48c7.654-3.17 11.288-11.945 8.118-19.599s-11.944-11.287-19.599-8.118l-27.716 11.48c-7.654 3.17-11.288 11.945-8.118 19.599 3.166 7.642 11.934 11.292 19.599 8.118z"/><path d="m173.259 416.558-11.48 27.716c-3.17 7.654.464 16.428 8.118 19.599 7.685 3.182 16.441-.495 19.599-8.118l11.48-27.716c3.17-7.654-.464-16.428-8.118-19.599-7.655-3.169-16.429.464-19.599 8.118z"/><path d="m338.741 95.442 11.48-27.716c3.17-7.654-.464-16.428-8.118-19.599-7.654-3.169-16.428.464-19.599 8.118l-11.48 27.716c-3.17 7.654.464 16.428 8.118 19.599 7.685 3.182 16.442-.495 19.599-8.118z"/><path d="m95.442 173.259-27.716-11.48c-7.654-3.17-16.428.464-19.599 8.118-3.17 7.654.464 16.428 8.118 19.599l27.716 11.48c7.685 3.182 16.441-.495 19.599-8.118 3.17-7.654-.464-16.429-8.118-19.599z"/><path d="m455.755 322.505-27.716-11.48c-7.654-3.169-16.428.464-19.599 8.118-3.17 7.654.464 16.428 8.118 19.599l27.716 11.48c7.685 3.182 16.441-.495 19.599-8.118 3.17-7.654-.464-16.429-8.118-19.599z"/><path d="m241 436v61c0 8.284 6.716 15 15 15s15-6.716 15-15v-61c0-8.284-6.716-15-15-15s-15 6.716-15 15z"/><path d="m271 76v-61c0-8.284-6.716-15-15-15s-15 6.716-15 15v61c0 8.284 6.716 15 15 15s15-6.716 15-15z"/><path d="m0 256c0 8.284 6.716 15 15 15h61c8.284 0 15-6.716 15-15s-6.716-15-15-15h-61c-8.284 0-15 6.716-15 15z"/><path d="m497 241h-61c-8.284 0-15 6.716-15 15s6.716 15 15 15h61c8.284 0 15-6.716 15-15s-6.716-15-15-15z"/></g></svg>
                  <span>Day</span>
                </div>
              )}
              {city.videos.night && (
                <div className={style === 'night' ? 'selected' : ''} onClick={() => setStyle('night')}>
                  <svg fill="white" viewBox="0 0 512.001 512.001" xmlns="http://www.w3.org/2000/svg"><g><path d="m406 151.001c8.284 0 15-6.716 15-15 0-24.813 20.187-45 45-45 8.284 0 15-6.716 15-15s-6.716-15-15-15c-24.393 0-45-21.065-45-46 0-8.284-6.716-15-15-15s-15 6.716-15 15c0 24.935-20.607 46-45 46-8.284 0-15 6.716-15 15s6.716 15 15 15c24.813 0 45 20.187 45 45 0 8.284 6.716 15 15 15zm-15.253-75.15c5.784-4.41 10.865-9.568 15.253-15.479 4.387 5.91 9.468 11.069 15.253 15.479-5.781 4.312-10.922 9.437-15.253 15.203-4.331-5.767-9.472-10.891-15.253-15.203z"/><path d="m301 106.001c0-8.284-6.716-15-15-15s-15 6.716-15 15c0 41.355-33.645 75-75 75-8.284 0-15 6.716-15 15s6.716 15 15 15c41.355 0 75 33.645 75 75 0 8.284 6.716 15 15 15s15-6.716 15-15c0-41.355 33.645-75 75-75 8.284 0 15-6.716 15-15s-6.716-15-15-15c-41.355 0-75-33.645-75-75zm-15 125.972c-8.871-14.722-21.25-27.101-35.971-35.972 14.722-8.871 27.1-21.25 35.971-35.972 8.871 14.722 21.25 27.101 35.971 35.972-14.721 8.871-27.1 21.249-35.971 35.972z"/><path d="m256 512.001c128.638 0 238.83-96.522 255.862-221.298.946-6.93-3.022-13.593-9.566-16.063-6.542-2.469-13.924-.09-17.793 5.737-33.016 49.73-91.835 80.624-153.503 80.624-99.252 0-180-80.748-180-180 0-61.668 30.893-120.487 80.624-153.503 5.826-3.868 8.207-11.25 5.737-17.793-2.469-6.543-9.131-10.511-16.063-9.566-124.939 17.055-221.298 127.397-221.298 255.862 0 140.959 115.05 256 256 256zm-87.774-466.347c-29.922 37.658-47.226 85.737-47.226 135.347 0 115.794 94.206 210 210 210 49.61 0 97.688-17.304 135.347-47.226-34.932 81.747-117.091 138.226-210.347 138.226-124.617 0-226-101.383-226-226 0-93.256 56.479-175.415 138.226-210.347z"/></g></svg>
                  <span>Night</span>
                </div>
              )}
              {city.videos.rainy && (
                <div className={style === 'rainy' ? 'selected' : ''} onClick={() => setStyle('rainy')}>
                  <svg fill="white" viewBox="0 0 513.003 513.003" xmlns="http://www.w3.org/2000/svg"><g><path d="m424.502 337h-312c-61.757 0-112-50.243-112-112 0-53.88 37.943-98.533 88.081-109.436 2.343-64.12 55.237-115.564 119.919-115.564 48.54 0 89.514 28.544 108.62 68.999 62.24-18.504 124.343 28.942 123.369 93.457 40.917 7.541 72.011 43.479 72.011 86.544 0 48.523-39.477 88-88 88zm-216-305c-51.437 0-92.228 44.178-87.644 95.885.784 8.851-5.806 16.67-14.691 17.363-41.308 3.228-73.665 38.259-73.665 79.752 0 44.112 35.888 80 80 80h312c30.878 0 56-25.122 56-56 0-29.061-22.745-56-57.604-56-10.096 0-17.694-9.263-15.68-19.184 10.684-52.596-44.419-94.131-91.872-69.782-8.872 4.552-19.722-.041-22.617-9.596-11.139-36.762-45.775-62.438-84.227-62.438z"/><path d="m312.49 457.003c-11.758 0-19.652-12.453-14.299-23.159l32-64c3.952-7.904 13.564-11.107 21.466-7.156 7.904 3.952 11.107 13.563 7.156 21.466l-32 64c-2.803 5.608-8.455 8.849-14.323 8.849z"/><path d="m456.49 457.003c-11.758 0-19.652-12.453-14.299-23.159l32-64c3.952-7.904 13.563-11.107 21.466-7.156 7.904 3.952 11.107 13.563 7.156 21.466l-32 64c-2.803 5.608-8.455 8.849-14.323 8.849z"/><path d="m168.49 457.003c-11.758 0-19.652-12.453-14.299-23.159l32-64c3.951-7.904 13.564-11.107 21.466-7.156 7.904 3.952 11.107 13.563 7.156 21.466l-32 64c-2.803 5.608-8.455 8.849-14.323 8.849z"/><path d="m24.49 457.003c-11.758 0-19.652-12.453-14.299-23.159l32-64c3.951-7.904 13.564-11.107 21.466-7.156 7.904 3.952 11.107 13.563 7.156 21.466l-32 64c-2.803 5.608-8.455 8.849-14.323 8.849z"/><path d="m216.49 513.003c-11.758 0-19.652-12.453-14.299-23.159l32-64c3.952-7.904 13.563-11.107 21.466-7.156 7.904 3.952 11.107 13.563 7.156 21.466l-32 64c-2.803 5.608-8.455 8.849-14.323 8.849z"/><path d="m360.49 513.003c-11.758 0-19.652-12.453-14.299-23.159l32-64c3.952-7.904 13.563-11.107 21.466-7.156 7.904 3.952 11.107 13.563 7.156 21.466l-32 64c-2.803 5.608-8.455 8.849-14.323 8.849z"/><path d="m72.49 513.003c-11.758 0-19.652-12.453-14.299-23.159l32-64c3.952-7.904 13.563-11.107 21.466-7.156 7.904 3.952 11.107 13.563 7.156 21.466l-32 64c-2.803 5.608-8.455 8.849-14.323 8.849z"/></g></svg>
                  <span>Rain</span>
                </div>
              )}
            </div>
            <div className="source" onClick={() => setEnableSound(current => !current)}>
              <span>{enableSound ? 'Disable sound' : 'Enable sound'}</span>
            </div>
            <div className="source">
              <a href={videoURL} target="_blank" rel="noreferrer">Video Source</a>
            </div>
          </div>
        )}
        <div className="expand" onClick={() => setExpanded(current => !current)}>
          {expanded ? '»' : '«'}
        </div>
      </div>
    </div>
  );
}

export default App;
